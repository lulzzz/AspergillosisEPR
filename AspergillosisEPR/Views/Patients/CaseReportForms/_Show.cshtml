@model AspergillosisEPR.Models.CaseReportForms.ViewModels.CaseReportFormViewModel;
@using AspergillosisEPR.Models.CaseReportForms.ViewModels;
@{
    var globalCursor = 0;
}
<fieldset>
    <header>
        <strong>
            @Model.Name
        </strong>
    </header>
    <form class="smart-form">
        @foreach (var fsection in Model.Sections)
        {
            <fieldset>
                <h3>@fsection.Section.Name</h3>
                @for (int cursor = 0; cursor < fsection.Section.CaseReportFormResultFields.Count; cursor++)
                {
                    var field = fsection.Section.CaseReportFormResultFields.ToList()[cursor];
                    var fieldVm = new CaseReportFormFieldViewModel();
                    fieldVm.Field = field;
                    fieldVm.Index = globalCursor.ToString();
                    @Html.Partial("/Views/CaseReportForms/CaseReportFormFieldTypes/FieldTypes/_"
                                                + field.CaseReportFormFieldType.FieldPartial() + ".cshtml", fieldVm)
                    globalCursor++;
                }
            </fieldset>
        }
        @for (int cursor = 0; cursor < @Model.Fields.Count; cursor++)
        {
            var formField = @Model.Fields.ToList()[cursor];
            var formFieldVm = new CaseReportFormFieldViewModel();
            formFieldVm.Field = formField;
            formFieldVm.Index = globalCursor.ToString();
            @Html.Partial("/Views/CaseReportForms/CaseReportFormFieldTypes/FieldTypes/_"
                            + formField.CaseReportFormFieldType.FieldPartial() + ".cshtml", formFieldVm);
            globalCursor++;
        }
    </form>

</fieldset>                   